{"version":3,"file":"storage-BjpjQMj9.js","sources":["../../src/lib/constants.ts","../../src/lib/storage.ts"],"sourcesContent":["// Constants for Better YouTube Chrome Extension\n\n// Storage keys\nexport const STORAGE_KEYS = {\n  SCRAPE_CREATORS_API_KEY: \"scrapeCreatorsApiKey\",\n  OPENROUTER_API_KEY: \"openRouterApiKey\",\n  SUMMARIZER_RECOMMENDED_MODEL: \"summarizerRecommendedModel\",\n  SUMMARIZER_CUSTOM_MODEL: \"summarizerCustomModel\",\n  REFINER_RECOMMENDED_MODEL: \"refinerRecommendedModel\",\n  REFINER_CUSTOM_MODEL: \"refinerCustomModel\",\n  AUTO_GENERATE: \"autoGenerate\",\n  SHOW_SUBTITLES: \"showSubtitles\",\n  CAPTION_FONT_SIZE: \"captionFontSize\",\n  ANALYSIS_FONT_SIZE: \"analysisFontSize\",\n  TARGET_LANGUAGE_RECOMMENDED: \"targetLanguageRecommended\",\n  TARGET_LANGUAGE_CUSTOM: \"targetLanguageCustom\",\n  FAST_MODE: \"fastMode\",\n  QUALITY_MODEL: \"qualityModel\",\n} as const;\n\n// Timing constants\nexport const TIMING = {\n  AUTO_GENERATION_DELAY_MS: 2000,\n  INIT_RETRY_DELAY_MS: 500,\n  SUBTITLE_UPDATE_INTERVAL_MS: 100,\n  MAX_INIT_ATTEMPTS: 5,\n  CONTENT_SCRIPT_INIT_DELAY_MS: 500,\n  STATUS_MESSAGE_DISPLAY_MS: 2000,\n  ANALYSIS_SUCCESS_DISPLAY_MS: 3000,\n  CAPTION_CHECK_DELAY_MS: 500,\n  TRANSCRIPT_CACHE_TTL_MS: 2 * 60 * 1000, // 2 minutes\n  SCRAPE_API_TIMEOUT_MS: 30 * 1000, // 30 seconds\n  PROCESSING_TIMEOUT_MS: 2 * 60 * 1000, // 2 minutes\n  RETRY_BACKOFF_MULTIPLIER_MS: 1000, // Base unit for exponential backoff\n} as const;\n\n// Storage constants\nexport const STORAGE = {\n  QUOTA_BYTES: 10 * 1024 * 1024,\n  MAX_STORAGE_BYTES: 9.9 * 1024 * 1024, // 10 MB max\n  ESTIMATED_VIDEO_SIZE_BYTES: 30 * 1024,\n  CLEANUP_BATCH_SIZE: 10,\n} as const;\n\n// Model options\nexport const RECOMMENDED_SUMMARIZER_MODELS = [\n  { value: \"google/gemini-3-flash-preview\", label: \"Gemini 3 Flash\" },\n  { value: \"google/gemini-3-pro-preview\", label: \"Gemini 3 Pro\" },\n  { value: \"openai/gpt-5-mini\", label: \"GPT-5 Mini\" },\n  { value: \"openai/gpt-5.2\", label: \"GPT-5.2\" },\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n] as const;\n\nexport const RECOMMENDED_REFINER_MODELS = [\n  { value: \"google/gemini-2.5-flash-lite-preview-09-2025\", label: \"Gemini 2.5 Flash Lite\" },\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n] as const;\n\n// Target language options\nexport const TARGET_LANGUAGES = [\n  { value: \"auto\", label: \"Auto\" },\n  { value: \"en\", label: \"English\" },\n  { value: \"zh-TW\", label: \"Chinese\" },\n] as const;\n\n// Default values (first item from recommended lists)\nexport const DEFAULTS = {\n  MODEL_SUMMARIZER: RECOMMENDED_SUMMARIZER_MODELS[0].value,\n  MODEL_REFINER: RECOMMENDED_REFINER_MODELS[0].value,\n  AUTO_GENERATE: false,\n  SHOW_SUBTITLES: true,\n  CAPTION_FONT_SIZE: \"M\" as const,\n  ANALYSIS_FONT_SIZE: \"M\" as const,\n  TARGET_LANGUAGE_RECOMMENDED: \"auto\",\n  TARGET_LANGUAGE_CUSTOM: \"\",\n} as const;\n\n// Font size mappings\nexport const FONT_SIZES = {\n  CAPTION: {\n    S: { base: \"1.4vw\", max: \"22px\", min: \"12px\", fullscreen: \"1.7vw\", fullscreenMax: \"28px\" },\n    M: { base: \"1.8vw\", max: \"28px\", min: \"14px\", fullscreen: \"2.2vw\", fullscreenMax: \"36px\" },\n    L: { base: \"2.2vw\", max: \"34px\", min: \"16px\", fullscreen: \"2.7vw\", fullscreenMax: \"44px\" },\n  },\n  ANALYSIS: {\n    S: { base: \"16px\", h2: \"22px\", h3: \"19px\" },\n    M: { base: \"18px\", h2: \"26px\", h3: \"22px\" },\n    L: { base: \"20px\", h2: \"30px\", h3: \"24px\" },\n  },\n} as const;\n\n// API endpoints\nexport const API_ENDPOINTS = {\n  SCRAPE_CREATORS: \"https://api.scrapecreators.com/v1/youtube/video\",\n  OPENROUTER: \"https://openrouter.ai/api/v1/chat/completions\",\n} as const;\n\n// YouTube-specific constants\nexport const YOUTUBE = {\n  VIDEO_ID_LENGTH: 11,\n  SELECTORS: {\n    VIDEO_PLAYER: \"video.html5-main-video\",\n    MOVIE_PLAYER: \"#movie_player\",\n    VIDEO_CONTAINER: \".html5-video-container\",\n  },\n} as const;\n\n// Message actions\nexport const MESSAGE_ACTIONS = {\n  SCRAPE_VIDEO: \"scrapeVideo\",\n  SCRAPE_VIDEO_COMPLETED: \"scrapeVideoCompleted\",\n  FETCH_SUBTITLES: \"fetchSubtitles\",\n  GENERATE_SUBTITLES: \"generateSubtitles\",\n  GENERATE_SUMMARY: \"generateSummary\",\n  SUBTITLES_GENERATED: \"subtitlesGenerated\",\n  SUMMARY_GENERATED: \"summaryGenerated\",\n  UPDATE_POPUP_STATUS: \"updatePopupStatus\",\n  TOGGLE_SUBTITLES: \"toggleSubtitles\",\n  GET_VIDEO_TITLE: \"getVideoTitle\",\n  SHOW_ERROR: \"showError\",\n  UPDATE_CAPTION_FONT_SIZE: \"updateCaptionFontSize\",\n} as const;\n\n// Element IDs\nexport const ELEMENT_IDS = {\n  SUBTITLE_CONTAINER: \"youtube-gemini-subtitles-container\",\n  SUBTITLE_TEXT: \"youtube-gemini-subtitles-text\",\n} as const;\n\nexport const REFINER_CONFIG = {\n  MAX_SEGMENTS_PER_CHUNK: 30,\n  CHUNK_SENTINEL: \"<<<__CHUNK_END__>>>\",\n} as const;\n\nexport const SEGMENT_PARSER_CONFIG = {\n  GAP_PENALTY: -0.5,\n  TAIL_GUARD_SIZE: 3,\n  LENGTH_TOLERANCE: 0.5,\n} as const;\n\n// Error messages\nexport const ERROR_MESSAGES = {\n  CONTEXT_INVALIDATED: \"Extension context invalidated\",\n  VIDEO_ID_REQUIRED: \"Video ID is required.\",\n  NO_VIDEO_ID: \"Could not extract video ID from URL.\",\n  NO_TRANSCRIPT: \"No transcript available for this video\",\n  SCRAPE_KEY_MISSING: \"Scrape Creators API key not found. Please set it in settings.\",\n  OPENROUTER_KEY_MISSING: \"OpenRouter API key not found\",\n  NOT_YOUTUBE_PAGE: \"Not a YouTube video page\",\n  SUMMARY_IN_PROGRESS: \"Summary generation is already in progress for this video.\",\n} as const;\n\n// Storage cleanup configuration\nexport const STORAGE_CLEANUP = {\n  MIN_VIDEOS_TO_KEEP: 5,\n  DEFAULT_BATCH_SIZE: 10,\n} as const;\n\n// Types\nexport type FontSize = \"S\" | \"M\" | \"L\";\nexport type TargetLanguage = \"auto\" | \"en\" | \"zh-TW\" | string;\n","/**\n * Chrome storage management\n */\n\nimport { STORAGE, STORAGE_CLEANUP, YOUTUBE } from \"./constants\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface SubtitleSegment {\n  text: string;\n  startTime: number;\n  endTime: number;\n  startTimeText?: string | null;\n}\n\nexport interface VideoMetadata {\n  url: string;\n  title: string | null;\n  thumbnail: string | null;\n  author: string | null;\n  duration: string | null;\n  upload_date: string | null;\n  view_count: number | null;\n  like_count: number | null;\n}\n\nexport interface StoredAnalysis {\n  analysis: any;\n  quality?: any;\n  timestamp: number;\n  modelUsed: string;\n  targetLanguage?: string | null;\n}\n\nexport interface StorageUsage {\n  bytesUsed: number;\n  bytesAvailable: number;\n  percentageUsed: number;\n}\n\n// ============================================================================\n// Storage Keys\n// ============================================================================\n\nconst StorageKeys = {\n  subtitles: (videoId: string) => videoId,\n  metadata: (videoId: string) => `video_info_${videoId}`,\n  analysis: (videoId: string) => `analysis_${videoId}`,\n} as const;\n\n// ============================================================================\n// Core Storage Operations\n// ============================================================================\n\nconst isExtension = typeof chrome !== \"undefined\" && !!chrome.storage?.local;\n\nasync function storageSet(items: Record<string, unknown>): Promise<void> {\n  if (!isExtension) {\n    for (const [key, value] of Object.entries(items)) {\n      localStorage.setItem(key, JSON.stringify(value));\n    }\n    return;\n  }\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.set(items, () => {\n      chrome.runtime.lastError ? reject(new Error(chrome.runtime.lastError.message)) : resolve();\n    });\n  });\n}\n\nasync function storageGet<T>(key: string): Promise<T | null> {\n  if (!isExtension) {\n    const item = localStorage.getItem(key);\n    return item ? (JSON.parse(item) as T) : null;\n  }\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get([key], (result) => {\n      resolve(result[key] ?? null);\n    });\n  });\n}\n\nasync function storageGetMultiple<T extends Record<string, unknown>>(\n  keys: string[]\n): Promise<Partial<T>> {\n  if (!isExtension) {\n    const result: Partial<T> = {};\n    for (const key of keys) {\n      const item = localStorage.getItem(key);\n      if (item) {\n        (result as Record<string, unknown>)[key] = JSON.parse(item);\n      }\n    }\n    return result;\n  }\n\n  return new Promise((resolve) => {\n    chrome.storage.local.get(keys, (result) => {\n      resolve(result as Partial<T>);\n    });\n  });\n}\n\nasync function storageRemove(keys: string[]): Promise<void> {\n  if (!isExtension) {\n    keys.forEach(key => localStorage.removeItem(key));\n    return;\n  }\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.remove(keys, () => {\n      chrome.runtime.lastError ? reject(new Error(chrome.runtime.lastError.message)) : resolve();\n    });\n  });\n}\n\nasync function storageGetAll(): Promise<Record<string, unknown>> {\n  if (!isExtension) {\n    const allItems: Record<string, unknown> = {};\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key) {\n        const item = localStorage.getItem(key);\n        if (item) {\n          allItems[key] = JSON.parse(item);\n        }\n      }\n    }\n    return allItems;\n  }\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.get(null, (allItems) => {\n      chrome.runtime.lastError ? reject(new Error(chrome.runtime.lastError.message)) : resolve(allItems);\n    });\n  });\n}\n\n// ============================================================================\n// Video Data Storage\n// ============================================================================\n\nexport async function getStoredSubtitles(videoId: string): Promise<SubtitleSegment[] | null> {\n  const key = StorageKeys.subtitles(videoId);\n  return storageGet<SubtitleSegment[]>(key);\n}\n\nexport async function saveSubtitles(videoId: string, subtitles: SubtitleSegment[]): Promise<void> {\n  const key = StorageKeys.subtitles(videoId);\n  try {\n    await storageSet({ [key]: subtitles });\n    console.log(`Subtitles saved for video: ${videoId}`);\n  } catch (error) {\n    if (error instanceof Error && error.message.includes(\"QUOTA\")) {\n      console.warn(\"Storage quota exceeded, cleaning up...\");\n      await cleanupOldVideos(STORAGE.CLEANUP_BATCH_SIZE);\n      await storageSet({ [key]: subtitles });\n      console.log(`Subtitles saved after cleanup: ${videoId}`);\n    } else {\n      throw error;\n    }\n  }\n}\n\nexport async function getStoredVideoMetadata(videoId: string): Promise<VideoMetadata | null> {\n  const key = StorageKeys.metadata(videoId);\n  return storageGet<VideoMetadata>(key);\n}\n\nexport async function saveVideoMetadata(videoId: string, metadata: VideoMetadata): Promise<void> {\n  const key = StorageKeys.metadata(videoId);\n  await storageSet({ [key]: metadata });\n  console.log(`Video metadata saved: ${videoId}`);\n}\n\nexport async function getStoredAnalysis(videoId: string): Promise<StoredAnalysis | null> {\n  const key = StorageKeys.analysis(videoId);\n  return storageGet<StoredAnalysis>(key);\n}\n\nexport async function saveAnalysis(\n  videoId: string,\n  analysis: any,\n  modelUsed: string,\n  targetLanguage?: string | null,\n  quality?: any\n): Promise<void> {\n  const key = StorageKeys.analysis(videoId);\n  const storedAnalysis: StoredAnalysis = {\n    analysis,\n    quality,\n    timestamp: Date.now(),\n    modelUsed,\n    targetLanguage,\n  };\n\n  try {\n    await storageSet({ [key]: storedAnalysis });\n    console.log(`Analysis saved: ${videoId}`);\n  } catch (error) {\n    if (error instanceof Error && error.message.includes(\"QUOTA\")) {\n      console.warn(\"Storage quota exceeded, cleaning up...\");\n      await cleanupOldVideos(STORAGE.CLEANUP_BATCH_SIZE);\n      await storageSet({ [key]: storedAnalysis });\n      console.log(`Analysis saved after cleanup: ${videoId}`);\n    } else {\n      throw error;\n    }\n  }\n}\n\n// ============================================================================\n// Settings Storage\n// ============================================================================\n\nexport async function getStorageValue<T>(key: string): Promise<T | null> {\n  return storageGet<T>(key);\n}\n\nexport async function setStorageValue<T>(key: string, value: T): Promise<void> {\n  return storageSet({ [key]: value });\n}\n\nexport async function getStorageValues<T extends Record<string, unknown>>(\n  keys: string[]\n): Promise<Partial<T>> {\n  return storageGetMultiple<T>(keys);\n}\n\n// ============================================================================\n// Storage Cleanup\n// ============================================================================\n\nexport async function getStorageUsage(): Promise<StorageUsage> {\n  if (!isExtension) {\n    return Promise.resolve({\n      bytesUsed: 0,\n      bytesAvailable: STORAGE.QUOTA_BYTES,\n      percentageUsed: 0,\n    });\n  }\n\n  return new Promise((resolve) => {\n    chrome.storage.local.getBytesInUse(null, (bytesInUse) => {\n      resolve({\n        bytesUsed: bytesInUse || 0,\n        bytesAvailable: STORAGE.QUOTA_BYTES - (bytesInUse || 0),\n        percentageUsed: ((bytesInUse || 0) / STORAGE.QUOTA_BYTES) * 100,\n      });\n    });\n  });\n}\n\nasync function getVideoRelatedKeys(allItems: Record<string, unknown>): Promise<string[]> {\n  const keys: string[] = [];\n  for (const key of Object.keys(allItems)) {\n    if ((key.length === YOUTUBE.VIDEO_ID_LENGTH && Array.isArray(allItems[key])) ||\n        key.startsWith('video_info_') || key.startsWith('analysis_')) {\n      keys.push(key);\n    }\n  }\n  return keys;\n}\n\nasync function cleanupOldVideos(countToRemove: number): Promise<void> {\n  const allItems = await storageGetAll();\n  const videoKeys = await getVideoRelatedKeys(allItems);\n\n  if (videoKeys.length === 0) {\n    console.log(\"No video data to clean up\");\n    return;\n  }\n\n  const removeCount =\n    videoKeys.length <= countToRemove\n      ? Math.max(1, videoKeys.length - STORAGE_CLEANUP.MIN_VIDEOS_TO_KEEP)\n      : countToRemove;\n\n  const keysToRemove = videoKeys.slice(0, removeCount);\n  await storageRemove(keysToRemove);\n  console.log(`Cleaned up ${keysToRemove.length} video data entries`);\n}\n\nexport async function ensureStorageSpace(): Promise<void> {\n  const usage = await getStorageUsage();\n\n  if (usage.bytesUsed > STORAGE.MAX_STORAGE_BYTES) {\n    console.log(`Storage at ${usage.percentageUsed.toFixed(1)}%, cleaning up...`);\n    const videosToRemove = Math.ceil(\n      (usage.bytesUsed - STORAGE.MAX_STORAGE_BYTES) / STORAGE.ESTIMATED_VIDEO_SIZE_BYTES\n    );\n    await cleanupOldVideos(videosToRemove);\n  }\n}\n"],"names":["STORAGE_KEYS","TIMING","STORAGE","RECOMMENDED_SUMMARIZER_MODELS","RECOMMENDED_REFINER_MODELS","TARGET_LANGUAGES","DEFAULTS","FONT_SIZES","API_ENDPOINTS","YOUTUBE","MESSAGE_ACTIONS","REFINER_CONFIG","SEGMENT_PARSER_CONFIG","ERROR_MESSAGES","STORAGE_CLEANUP","StorageKeys","videoId","isExtension","_a","storageSet","items","key","value","resolve","reject","storageGet","item","result","storageGetMultiple","keys","storageRemove","storageGetAll","allItems","i","getStoredSubtitles","getStoredVideoMetadata","saveVideoMetadata","metadata","getStoredAnalysis","saveAnalysis","analysis","modelUsed","targetLanguage","quality","storedAnalysis","error","cleanupOldVideos","getStorageValue","setStorageValue","getStorageValues","getVideoRelatedKeys","countToRemove","videoKeys","removeCount","keysToRemove"],"mappings":"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"}
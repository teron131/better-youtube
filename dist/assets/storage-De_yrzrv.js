function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const p={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",ANALYSIS_FONT_SIZE:"analysisFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom",FAST_MODE:"fastMode",QUALITY_MODEL:"qualityModel"},C={AUTO_GENERATION_DELAY_MS:2e3,INIT_RETRY_DELAY_MS:500,SUBTITLE_UPDATE_INTERVAL_MS:100,MAX_INIT_ATTEMPTS:5,CONTENT_SCRIPT_INIT_DELAY_MS:500,STATUS_MESSAGE_DISPLAY_MS:2e3,ANALYSIS_SUCCESS_DISPLAY_MS:3e3,CAPTION_CHECK_DELAY_MS:500,TRANSCRIPT_CACHE_TTL_MS:2*60*1e3,SCRAPE_API_TIMEOUT_MS:30*1e3,PROCESSING_TIMEOUT_MS:2*60*1e3,RETRY_BACKOFF_MULTIPLIER_MS:1e3},u={CLEANUP_BATCH_SIZE:10},T=[{value:"google/gemini-3-flash-preview",label:"Gemini 3 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.2",label:"GPT-5.2"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],A=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],d=[{value:"auto",label:"Auto"},{value:"en",label:"English"},{value:"zh-TW",label:"Chinese"}],y={MODEL_SUMMARIZER:T[0].value,MODEL_REFINER:A[0].value,SHOW_SUBTITLES:!0,ANALYSIS_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto"},G={ANALYSIS:{S:{base:"16px",h2:"22px",h3:"19px"},M:{base:"18px",h2:"26px",h3:"22px"},L:{base:"20px",h2:"30px",h3:"24px"}}},L={SCRAPE_CREATORS:"https://api.scrapecreators.com/v1/youtube/video",OPENROUTER:"https://openrouter.ai/api/v1/chat/completions"},R={VIDEO_ID_LENGTH:11},P={SCRAPE_VIDEO:"scrapeVideo",SCRAPE_VIDEO_COMPLETED:"scrapeVideoCompleted",FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"},D={MAX_SEGMENTS_PER_CHUNK:20,CHUNK_SENTINEL:"<<<__CHUNK_END__>>>"},h={GAP_PENALTY:-.5,TAIL_GUARD_SIZE:3,LENGTH_TOLERANCE:.5},U={SCRAPE_KEY_MISSING:"Scrape Creators API key not found. Please set it in settings.",OPENROUTER_KEY_MISSING:"OpenRouter API key not found"},I={MIN_VIDEOS_TO_KEEP:5},s={subtitles:e=>e,metadata:e=>`video_info_${e}`,analysis:e=>`analysis_${e}`};var c;const n=typeof chrome<"u"&&!!((c=chrome.storage)!=null&&c.local);async function E(e){if(!n){for(const[t,a]of Object.entries(e))localStorage.setItem(t,JSON.stringify(a));return}return new Promise((t,a)=>{chrome.storage.local.set(e,()=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):t()})})}async function l(e){if(!n){const t=localStorage.getItem(e);return t?JSON.parse(t):null}return new Promise(t=>{chrome.storage.local.get([e],a=>{t(a[e]??null)})})}async function g(e){if(!n){const t={};for(const a of e){const o=localStorage.getItem(a);o&&(t[a]=JSON.parse(o))}return t}return new Promise(t=>{chrome.storage.local.get(e,a=>{t(a)})})}async function M(e){if(!n){e.forEach(t=>localStorage.removeItem(t));return}return new Promise((t,a)=>{chrome.storage.local.remove(e,()=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):t()})})}async function O(){if(!n){const e={};for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a){const o=localStorage.getItem(a);o&&(e[a]=JSON.parse(o))}}return e}return new Promise((e,t)=>{chrome.storage.local.get(null,a=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):e(a)})})}async function v(e){const t=s.subtitles(e);return l(t)}async function b(e){const t=s.metadata(e);return l(t)}async function F(e,t){const a=s.metadata(e);await E({[a]:t}),console.log(`Video metadata saved: ${e}`)}async function w(e){const t=s.analysis(e);return l(t)}async function Y(e,t,a,o,r){const _=s.analysis(e),S={analysis:t,quality:r,timestamp:Date.now(),modelUsed:a,targetLanguage:o};try{await E({[_]:S}),console.log(`Analysis saved: ${e}`)}catch(i){if(i instanceof Error&&i.message.includes("QUOTA"))console.warn("Storage quota exceeded, cleaning up..."),await m(u.CLEANUP_BATCH_SIZE),await E({[_]:S}),console.log(`Analysis saved after cleanup: ${e}`);else throw i}}async function V(e){return l(e)}async function K(e,t){return E({[e]:t})}async function k(e){return g(e)}async function N(e){const t=[];for(const a of Object.keys(e))(a.length===R.VIDEO_ID_LENGTH&&Array.isArray(e[a])||a.startsWith("video_info_")||a.startsWith("analysis_"))&&t.push(a);return t}async function m(e){const t=await O(),a=await N(t);if(a.length===0){console.log("No video data to clean up");return}const o=a.length<=e?Math.max(1,a.length-I.MIN_VIDEOS_TO_KEEP):e,r=a.slice(0,o);await M(r),console.log(`Cleaned up ${r.length} video data entries`)}export{L as A,y as D,U as E,G as F,P as M,T as R,p as S,C as T,V as a,A as b,d as c,k as d,h as e,D as f,f as g,w as h,b as i,v as j,F as k,Y as l,K as s};
//# sourceMappingURL=storage-De_yrzrv.js.map
